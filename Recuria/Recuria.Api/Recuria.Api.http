@Recuria.Api_HostAddress = http://localhost:5132
@ownerUserId = {{$guid}}
@memberUserId = {{$guid}}
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3Njk0ODkxNzIsIm9yZ19pZCI6ImMzYmE0ZmJlLWZhZWMtNDRmNy1iMWVlLTczZDAzMDc1ZWI1MSIsInN1YiI6IjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMiIsImF1ZCI6IlJlY3VyaWEuQXBpIiwiaXNzIjoiUmVjdXJpYSIsImlhdCI6MTc2OTQ3NDc3Mn0.PRSz6CZHxYfqIkHUDHN6SiG6X_U2-MZJnwtUBnyPFLU

###
# Create owner user
@name createOwner
POST {{Recuria.Api_HostAddress}}/api/users
Content-Type: application/json

{
  "id": "{{ownerUserId}}",
  "email": "owner@recuria.local",
  "name": "Owner One"
}

###
# Create member user
@name createMember
POST {{Recuria.Api_HostAddress}}/api/users
Content-Type: application/json

{
  "id": "{{memberUserId}}",
  "email": "member@recuria.local",
  "name": "Member One"
}

###
# Create organization
@name createOrganization
POST {{Recuria.Api_HostAddress}}/api/organizations
Content-Type: application/json

{
  "name": "Acme Inc",
  "ownerId": "{{ownerUserId}}"
}

@organizationId = {{createOrganization.response.body.$.id}}

###
# Get organization by id
GET {{Recuria.Api_HostAddress}}/api/organizations/{{organizationId}}

###
# Get my organization (requires JWT with org_id claim)
GET {{Recuria.Api_HostAddress}}/api/organizations/me
Authorization: Bearer {{token}}

###
# Add member to organization
POST {{Recuria.Api_HostAddress}}/api/organizations/{{organizationId}}/users
Content-Type: application/json

{
  "userId": "{{memberUserId}}",
  "email": "member@recuria.local",
  "name": "Member One",
  "role": "Member"
}

###
# Start trial subscription for organization
@name createTrial
POST {{Recuria.Api_HostAddress}}/api/subscriptions/trial/{{organizationId}}

@subscriptionId = {{createTrial.response.body.$.id}}

###
# Get current subscription
GET {{Recuria.Api_HostAddress}}/api/subscriptions/current/{{organizationId}}

###
# Upgrade subscription
POST {{Recuria.Api_HostAddress}}/api/subscriptions/{{subscriptionId}}/upgrade
Content-Type: application/json

{
  "newPlan": "Pro"
}

###
# Cancel subscription
POST {{Recuria.Api_HostAddress}}/api/subscriptions/{{subscriptionId}}/cancel

###
# List invoices for organization
# Note: InvoiceController has no route prefix, so this is rooted at /organization/...
GET {{Recuria.Api_HostAddress}}/organization/{{organizationId}}

###
# Get invoice details (replace with an id from list)
@invoiceId = {{$guid}}
# Note: InvoiceController has no route prefix, so this is rooted at /{invoiceId}
GET {{Recuria.Api_HostAddress}}/{{invoiceId}}
