@Recuria.Api_HostAddress = http://localhost:5132
@ownerUserId = {{$guid}}
@memberUserId = {{$guid}}
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3Njk0ODkxNzIsIm9yZ19pZCI6ImMzYmE0ZmJlLWZhZWMtNDRmNy1iMWVlLTczZDAzMDc1ZWI1MSIsInN1YiI6IjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMiIsImF1ZCI6IlJlY3VyaWEuQXBpIiwiaXNzIjoiUmVjdXJpYSIsImlhdCI6MTc2OTQ3NDc3Mn0.PRSz6CZHxYfqIkHUDHN6SiG6X_U2-MZJnwtUBnyPFLU

###
# Health
GET {{Recuria.Api_HostAddress}}/api/health

###
# Dev bootstrap (Development only)
@name devBootstrap
POST {{Recuria.Api_HostAddress}}/api/dev/bootstrap
Content-Type: application/json

{
  "organizationName": "Acme Inc",
  "ownerEmail": "owner@recuria.local",
  "ownerName": "Owner One"
}

@token = {{devBootstrap.response.body.$.token}}
@organizationId = {{devBootstrap.response.body.$.organizationId}}
@ownerUserId = {{devBootstrap.response.body.$.ownerUserId}}

###
# Create owner user
@name createOwner
POST {{Recuria.Api_HostAddress}}/api/users
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "id": "{{ownerUserId}}",
  "email": "owner@recuria.local",
  "name": "Owner One"
}

###
# Create member user
@name createMember
POST {{Recuria.Api_HostAddress}}/api/users
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "id": "{{memberUserId}}",
  "email": "member@recuria.local",
  "name": "Member One"
}

###
# Create organization
@name createOrganization
POST {{Recuria.Api_HostAddress}}/api/organizations
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Acme Inc",
  "ownerId": "{{ownerUserId}}"
}

@organizationId = {{createOrganization.response.body.$.id}}

###
# Get organization by id
GET {{Recuria.Api_HostAddress}}/api/organizations/{{organizationId}}
Authorization: Bearer {{token}}

###
# Get my organization (requires JWT with org_id claim)
GET {{Recuria.Api_HostAddress}}/api/organizations/me
Authorization: Bearer {{token}}

###
# Who am I
GET {{Recuria.Api_HostAddress}}/api/auth/whoami
Authorization: Bearer {{token}}

###
# Add member to organization
POST {{Recuria.Api_HostAddress}}/api/organizations/{{organizationId}}/users
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "userId": "{{memberUserId}}",
  "email": "member@recuria.local",
  "name": "Member One",
  "role": "Member"
}

###
# Start trial subscription for organization
@name createTrial
POST {{Recuria.Api_HostAddress}}/api/subscriptions/trial/{{organizationId}}
Authorization: Bearer {{token}}

@subscriptionId = {{createTrial.response.body.$.id}}

###
# Get current subscription
GET {{Recuria.Api_HostAddress}}/api/subscriptions/current/{{organizationId}}
Authorization: Bearer {{token}}

###
# Upgrade subscription
POST {{Recuria.Api_HostAddress}}/api/subscriptions/{{subscriptionId}}/upgrade
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "newPlan": "Pro"
}

###
# Cancel subscription
POST {{Recuria.Api_HostAddress}}/api/subscriptions/{{subscriptionId}}/cancel
Authorization: Bearer {{token}}

###
# List invoices for organization
GET {{Recuria.Api_HostAddress}}/api/invoices/organization/{{organizationId}}
Authorization: Bearer {{token}}

###
# Get invoice details (replace with an id from list)
@invoiceId = {{$guid}}
GET {{Recuria.Api_HostAddress}}/api/invoices/{{invoiceId}}
Authorization: Bearer {{token}}
