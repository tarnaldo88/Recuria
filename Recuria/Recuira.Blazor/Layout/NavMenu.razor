@using MudBlazor
@inject Recuria.Client.IRecuriaApiClient Api

<MudNavMenu Class="pa-2">
    <MudNavLink Href="/" Match="NavLinkMatch.All" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
    <MudNavLink Href="/dashboard" Icon="@Icons.Material.Filled.Dashboard">Dashboard</MudNavLink>
    <MudNavLink Href="/invoices" Icon="@Icons.Material.Filled.ReceiptLong">Invoices</MudNavLink>
    <MudNavLink Href="/subscriptions" Icon="@Icons.Material.Filled.Subscriptions">Subscriptions</MudNavLink>
    <MudNavLink Href="/users" Icon="@Icons.Material.Filled.Group">Users</MudNavLink>
    <MudNavLink Href="/settings" Icon="@Icons.Material.Filled.Settings">Settings</MudNavLink>

    @if (_canSeeOps)
    {
        <MudNavLink Href="/ops" Icon="@Icons.Material.Filled.AdminPanelSettings">Ops</MudNavLink>
    }
</MudNavMenu>

@code {
    private bool _canSeeOps = false;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var who = await Api.WhoamiAsync();
            var role = who?.Role?.Trim();
            _canSeeOps = role is "Owner" or "Admin";
        }
        catch
        {
            _canSeeOps = false;
        }
    }
}
