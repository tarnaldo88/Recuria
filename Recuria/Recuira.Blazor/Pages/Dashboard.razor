@page "/dashboard"
@inject Recuira.Blazor.Services.AuthState Auth
@inject Recuria.Client.IRecuriaApiClient Api

<PageTitle>Dashboard</PageTitle>

<MudStack Spacing="3">
    <MudText Typo="Typo.h4">Dashboard</MudText>

    @if (_loading)
    {
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudSkeleton Height="180px" Width="100%" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudSkeleton Height="180px" Width="100%" />
            </MudItem>
        </MudGrid>
    }
    else if (_error is not null)
    {
        
    }
</MudStack>

@code {
    private bool _loading = true;
    private string? _error;
    private Recuria.Client.OrganizationDto? _org;
    private Recuria.Client.SubscriptionDetailsDto? _subscription;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var orgId = await Auth.GetOrgIdAsync();
            if(string.IsNullOrWhiteSpace(orgId))
            {
                _error = "No org id. Go to /bootstrap.";
                return;
            }

            _org = await Api.OrganizationsGETAsync(Guid.Parse(orgId));
            _subscription = await Api.CurrentAsync(Guid.Parse(orgId));
        }
        catch(Exception ex)
        {
            _error = ex.Message;
        }
        finally
        {
            _loading = false;
        }
    }
}
