@page "/subscriptions"
@inject Recuira.Blazor.Services.AuthState Auth
@inject Recuria.Client.IRecuriaApiClient Api

<PageTitle>Subscriptions</PageTitle>

<MudStack Spacing="3" Class="subs-page">
    <MudText Typo="Typo.h4">Subscriptions</MudText>

    @if (!string.IsNullOrWhiteSpace(_error))
    {
        <MudAlert Severity="Severity.Error" Variant="Variant.Filled" Dense="true">
            @_error
        </MudAlert>
    }

    @if (_loading)
    {
        <MudSkeleton Height="220px" Width="100%" />
    }
    else if(_details is null)
    {
        <MudAlert Severity="Severity.Warning" Dense="true">
            No subscription data available.
        </MudAlert>
    }
    else
    {
        <MudGrid>
            <MudCard Class="subs-card">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Current Subscription</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudStack Spacing="1" Class="subs-meta">
                        <MudText><b>Plan:</b> @PlanLabel(_details.Subscription.PlanCode)</MudText>
                        <MudText>
                            <b>Status:</b>
                            <MudChip T="string" Size="Size.Small" Color="@GetStatusColor(_details.Subscription.Status)">
                                @_details.Subscription.Status.ToString()
                            </MudChip>
                        </MudText>
                        <MudText><b>Trial:</b> @(_details.Subscription.IsTrial ? "Yes" : "No")</MudText>
                        <MudText><b>Past Due:</b> @(_details.Subscription.IsPastDue ? "Yes" : "No")</MudText>
                        <MudText><b>Period Start:</b> @_details.Subscription.PeriodStart.ToLocalTime().ToString("yyyy-MM-dd")</MudText>
                        <MudText><b>Period End:</b> @_details.Subscription.PeriodEnd.ToLocalTime().ToString("yyyy-MM-dd")</MudText>
                        <MudText><b>Subscription Id:</b> @_details.Subscription.Id</MudText>
                    </MudStack>
                </MudCardContent>
            </MudCard>
        </MudGrid>
    }

</MudStack>
@code {
    private string _error;
    private bool _loading;
    private bool _busy;
    private Guid _orgId;
    private Recuria.Client.SubscriptionDetailsDto? _details;
    private Recuria.Client.PlanType _selectedPlan = Recuria.Client.PlanType.Free;
    private bool _canUpgrade;
    private bool _canCancel;

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        
    }
}
